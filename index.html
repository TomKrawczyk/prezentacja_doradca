<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kalkulator Fotowoltaiki</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f5f7fa;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #1a5f3d;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }
    input, select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      background: #1a5f3d;
      color: white;
      border: none;
      padding: 14px 28px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
      transition: 0.3s;
    }
    button:hover {
      background: #147c4e;
    }
    .result {
      margin-top: 30px;
      padding: 20px;
      background: #f0f8f4;
      border-radius: 12px;
      border-left: 5px solid #1a5f3d;
      display: none;
    }
    .result h3 {
      margin-top: 0;
      color: #1a5f3d;
    }
    .highlight {
      font-size: 1.4em;
      font-weight: bold;
      color: #e67e22;
    }
    .chart-container {
      position: relative;
      height: 320px;
      margin-top: 30px;
    }
    .payback {
      font-weight: bold;
      color: #27ae60;
      font-size: 1.1em;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Kalkulator Fotowoltaiki</h1>
    <p style="text-align:center;color:#7f8c8d;">Oblicz moc instalacji, koszt i okres zwrotu</p>

    <div class="form-group">
      <label for="zużycie">Roczne zużycie prądu (kWh):</label>
      <input type="number" id="zużycie" placeholder="np. 4000" value="4000"/>
    </div>

    <div class="form-group">
      <label for="cena-kwh">Cena za 1 kWh (zł):</label>
      <input type="number" step="0.01" id="cena-kwh" placeholder="np. 0.92" value="0.92"/>
    </div>

    <div class="form-group">
      <label for="nasłonecznienie">Średnie nasłonecznienie (kWh/kWp/rok):</label>
      <select id="nasłonecznienie">
        <option value="1000">Polska Środkowa (1000 kWh/kWp)</option>
        <option value="950">Północ (950)</option>
        <option value="1050">Południe (1050)</option>
        <option value="1100">Południowy-zachód (1100)</option>
      </select>
    </div>

    <div class="form-group">
      <label for="sprawność">Sprawność systemu (%):</label>
      <input type="number" id="sprawność" placeholder="np. 85" value="85"/>
    </div>

    <div class="form-group">
      <label for="cena-kwp">Cena za 1 kWp instalacji (zł):</label>
      <input type="number" id="cena-kwp" placeholder="np. 4500" value="4500"/>
    </div>

    <div class="form-group">
      <label for="dotacja">
        <input type="checkbox" id="dotacja-check"/> Uwzględnij dotację Mój Prąd 6.0 (do 26 000 zł)
      </label>
      <div id="dotacja-group" style="display:none; margin-top:10px;">
        <label for="moc-dotacja">Moc instalacji (do obliczenia max dotacji):</label>
        <input type="number" step="0.1" id="moc-dotacja" placeholder="np. 6.5" disabled/>
        <p><small>Maks. dotacja: <span id="max-dotacja">0</span> zł</small></p>
      </div>
    </div>

    <button onclick="oblicz()">Oblicz instalację</button>

    <div class="result" id="wynik">
      <h3>Wyniki obliczeń</h3>
      <p><strong>Wymagana moc instalacji:</strong> <span id="moc" class="highlight"></span> kWp</p>
      <p><strong>Szacowany roczny uzysk:</strong> <span id="roczny-uzysk"></span> kWh</p>
      <p><strong>Szacowane oszczędności roczne:</strong> <span id="oszczędności"></span> zł</p>
      <p><strong>Koszt instalacji (brutto):</strong> <span id="koszt-brutto"></span> zł</p>
      <p id="dotacja-tekst" style="display:none;"><strong>Dotacja Mój Prąd:</strong> -<span id="kwota-dotacji"></span> zł</p>
      <p><strong>Koszt po dotacji:</strong> <span id="koszt-netto"></span> zł</p>
      <p class="payback"><strong>Okres zwrotu:</strong> <span id="zwrot-lat"></span> lat</p>

      <!-- Wykres ROI -->
      <div class="chart-container">
        <canvas id="roiChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    let roiChart = null;

    function oblicz() {
      // Pobranie danych
      const zużycie = parseFloat(document.getElementById('zużycie').value) || 0;
      const cenaKWh = parseFloat(document.getElementById('cena-kwh').value) || 0;
      const nasłonecznienie = parseFloat(document.getElementById('nasłonecznienie').value);
      const sprawność = parseFloat(document.getElementById('sprawność').value) / 100 || 0.85;
      const cenaKWP = parseFloat(document.getElementById('cena-kwp').value) || 4500;
      const dotacjaCheck = document.getElementById('dotacja-check').checked;

      if (zużycie <= 0 || cenaKWh <= 0) {
        alert("Podaj poprawne wartości!");
        return;
      }

      // Obliczenie wymaganej mocy
      const moc = zużycie / (nasłonecznienie * sprawność);
      const mocZaokrąglona = Math.ceil(moc * 2 2) / 2; // zaokrąglenie w górę co 0.5 kWp

      // Roczny uzysk
      const rocznyUzysk = mocZaokrąglona * nasłonecznienie * sprawność;

      // Oszczędności roczne
      const oszczędnościRoczne = rocznyUzysk * cenaKWh;

      // Koszt instalacji
      const kosztBrutto = mocZaokrąglona * cenaKWP;

      // Dotacja
      let dotacja = 0;
      let kosztNetto = kosztBrutto;

      if (dotacjaCheck) {
        document.getElementById('moc-dotacja').value = mocZaokrąglona.toFixed(2);
        const maxDotacja = Math.min(mocZaokrąglona * 4000, 26000);
        document.getElementById('max-dotacja').textContent = maxDotacja.toFixed(0);
        dotacja = maxDotacja;
        kosztNetto = Math.max(0, kosztBrutto - dotacja);
        document.getElementById('dotacja-tekst').style.display = 'block';
        document.getElementById('kwota-dotacji').textContent = dotacja.toLocaleString('pl-PL');
      } else {
        document.getElementById('dotacja-tekst').style.display = 'none';
      }

      // Okres zwrotu
      const okresZwrotu = kosztNetto / oszczędnościRoczne;

      // Wyświetlenie wyników
      document.getElementById('moc').textContent = mocZaokrąglona.toFixed(2) + " kWp";
      document.getElementById('roczny-uzysk').textContent = Math.round(rocznyUzysk) + " kWh";
      document.getElementById('oszczędności').textContent = Math.round(oszczędnościRoczne).toLocaleString('pl-PL') + " zł";
      document.getElementById('koszt-brutto').textContent = Math.round(kosztBrutto).toLocaleString('pl-PL') + " zł";
      document.getElementById('koszt-netto').textContent = Math.round(kosztNetto).toLocaleString('pl-PL') + " zł";
      document.getElementById('zwrot-lat').textContent = okresZwrotu < 1 ? "< 1" : okresZwrotu.toFixed(1);

      // Pokazanie wyników
      const wynik = document.getElementById('wynik');
      wynik.style.display = 'block';

      // Generuj wykres ROI
      generujWykresROI(kosztNetto, oszczędnościRoczne);
    }

    // Funkcja generująca wykres ROI
    function generujWykresROI(kosztPoczatkowy, oszczRoczne) {
      const ctx = document.getElementById('roiChart').getContext('2d');
      const lata = 20;
      const labels = Array.from({length: lata + 1}, (_, i) => `Rok ${i}`);
      const daneKoszt = [];
      const daneOszcz = [];

      for (let i = 0; i <= lata; i++) {
        daneKoszt.push(i === 0 ? kosztPoczatkowy : 0);
        daneOszcz.push(oszczRoczne * i);
      }

      const paybackYear = Math.ceil(kosztPoczatkowy / oszczRoczne);

      if (roiChart) roiChart.destroy();

      roiChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Koszt początkowy',
              data: daneKoszt,
              borderColor: '#e74c3c',
              backgroundColor: 'rgba(231,76,60,0.1)',
              borderWidth: 2,
              pointRadius: 4,
              fill: false
            },
            {
              label: 'Kumulowane oszczędności',
              data: daneOszcz,
              borderColor: '#27ae60',
              backgroundColor: 'rgba(39,174,96,0.15)',
              borderWidth: 3,
              pointRadius: 4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: { display: true, text: 'Zwrot z inwestycji (ROI)', font: { size: 16 } },
            tooltip: {
              callbacks: {
                label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toLocaleString('pl-PL')} zł`
              }
            },
            annotation: paybackYear <= lata ? {
              annotations: {
                payback: {
                  type: 'point',
                  xValue: `Rok ${paybackYear}`,
                  yValue: oszczRoczne * paybackYear,
                  backgroundColor: '#f39c12',
                  radius: 8,
                  label: {
                    content: `ZWROT: ${paybackYear} lat`,
                    enabled: true,
                    position: 'top',
                    backgroundColor: 'rgba(0,0,0,0.7)',
                    color: '#fff',
                    font: { weight: 'bold' }
                  }
                }
              }
            } : {}
          },
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Kwota (zł)' } },
            x: { title: { display: true, text: 'Lata eksploatacji' } }
          }
        }
      });
    }

    // Pokazywanie pola dotacji
    document.getElementById('dotacja-check').addEventListener('change', function() {
      document.getElementById('dotacja-group').style.display = this.checked ? 'block' : 'none';
    });
  </script>
</body>
</html>
